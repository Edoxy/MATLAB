% Laib09: equazioni differenziali
clear all
close all
clc
disp('***********************************************')
disp('*****************esercizio_9_1*****************')
disp('***********************************************')

% dati equazione e metodo
f = @(x,y) -y+x+1;
sol = @(x) x+exp(-x);
x0 = 0;
y0 = 1;
xN = 1;
z = linspace(x0,xN);
fprintf('%10s\t%8s\r\n','k','errore');
for k = 1:3
    N = 10^k;
    [x,y] = Eulero_esp(f,x0,y0,xN,N);
    figure(k)
    plot(x,y,'*','linewidth',2)
    hold on
    plot(z,sol(z),'k','linewidth',2)
    err(k) = abs(sol(x(end))-y(end));
    fprintf('%10.0d\t%6.4e\n',k,err(k)); 
end

disp('**********************************************FINE ESERCIZIO**********************************************')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
pause

clear all
close all
clc
disp('***********************************************')
disp('*****************esercizio_9_2*****************')
disp('***********************************************')
% dati sistema e metodo
f = @(x,y) [y(2); 0.1*(1-y(1)^2)*y(2)-y(1)];
x_0 = 0;
y_0 = [1;0];
x_N = 1;
for k = 1:3
    N = 10^k;
    [x,y] = Eulero_esp_system(f,x_0,y_0,x_N,N);
    plot(x,y(:,1),'linewidth',2)
    hold on
    pause
end

disp('**********************************************FINE ESERCIZIO**********************************************')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
pause

clear all
close all
clc
disp('***********************************************')
disp('*****************esercizio_9_3*****************')
disp('***********************************************')
% dati sistema e metodo
% dati equazione e metodo
f = @(x,y) -y+x+1;
sol = @(x) x+exp(-x);
x0 = 0;
y0 = 1;
xN = 1;
fprintf('%10s\t%8s\t%8s\r\n','k','erroreRK2','erroreRK4');
for k = 3:8
    N = 2^k;
    [x,yRK2] = Heun(f,x0,y0,xN,N);
    [x,yRK4] = Runge_Kutta_4(f,x0,y0,xN,N);
    errRK2(k) = abs(sol(x(end))-yRK2(end));
    errRK4(k) = abs(sol(x(end))-yRK4(end));
    fprintf('%10.0d\t%6.4e\t%6.4e\n',k,errRK2(k),errRK4(k)); 
end

disp('**********************************************FINE ESERCIZIO**********************************************')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
pause

clear all
close all
clc
disp('***********************************************')
disp('*****************esercizio_9_4*****************')
disp('***********************************************')
% dati equazione e metodo
f = @(x,y) -y+x+1;
sol = @(x) x+exp(-x);
x0 = 0;
y0 = 1;
xN = 1;
z = linspace(x0,xN);
[x1,y1] = ode45(f,[x0 xN],y0); 
err1 = abs(sol(1)-y1(end))
options = odeset('RelTol',1.0e-14,'AbsTol',1.0e-14);
[x2,y2] = ode45(f,[x0 xN],y0,options); 
err2 = abs(sol(1)-y2(end))
semilogy(x1,abs(sol(x1)-y1),'b',x2,abs(sol(x2)-y2),'k','linewidth',2)
legend('without options','with options')

disp('**********************************************FINE ESERCIZIO**********************************************')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
pause

clear all
close all
clc
disp('***********************************************')
disp('*****************esercizio_9_5*****************')
disp('***********************************************')
% dati sistema e metodo
f = @(x,y) [y(2); 0.1*(1-y(1)^2)*y(2)-y(1)];
x_0 = 0;
y_0 = [1;0];
x_N = 1;
kmax = 7;
[x,ye] = Runge_Kutta_4_system(f,x_0,y_0,x_N,2^kmax);
fprintf('%10s\t%8s\t%8s\r\n','k','erroreRK2','erroreRK4');
for k = 1:kmax-1
    N = 2^k;
    [x,y2] = Heun_system(f,x_0,y_0,x_N,N);
    [x,y4] = Runge_Kutta_4_system(f,x_0,y_0,x_N,N);
    plot(x,y2(:,1),'b',x,y4(:,1),'k','linewidth',2)
    legend('RK2','RK4')
    errRK2(k) = abs(ye(end,1)-y2(end,1));
    errRK4(k) = abs(ye(end,1)-y4(end,1));
    fprintf('%10.0d\t%6.4e\t%6.4e\n',k,errRK2(k),errRK4(k)); 
    pause
end

disp('**********************************************FINE ESERCIZIO**********************************************')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
